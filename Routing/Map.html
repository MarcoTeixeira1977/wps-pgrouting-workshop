<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Using this on a web-based map | WPS PgRouting Workshop OSGIS 2014</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.3.1">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../Appendix/Acknowledgements.html" />
    
    
    <link rel="prev" href="../Routing/WPS.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-level="4.5" data-basepath=".." data-revision="1416661240592">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="Introduction/Overview.html">
            
                
                    <a href="../Introduction/Overview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Overview
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="Introduction/Summary.html">
            
                
                    <a href="../Introduction/Summary.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Package Summary
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1.2" data-path="Introduction/installation.html">
            
                
                    <a href="../Introduction/installation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         Installation
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="GettingStarted/GettingStarted.html">
            
                
                    <a href="../GettingStarted/GettingStarted.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Getting Started
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="GettingStarted/Customising.html">
            
                
                    <a href="../GettingStarted/Customising.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Customising Your Server
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2.2" data-path="GettingStarted/HelloWorld.html">
            
                
                    <a href="../GettingStarted/HelloWorld.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                         Hello World
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="Geoprocessing/Introduction.html">
            
                
                    <a href="../Geoprocessing/Introduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Basic Geoprocessing
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="Geoprocessing/Testing.html">
            
                
                    <a href="../Geoprocessing/Testing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         Testing with QGIS
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="Routing/Overview.html">
            
                
                    <a href="../Routing/Overview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Routing
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="Routing/Functions.html">
            
                
                    <a href="../Routing/Functions.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Routing Functions
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.2" data-path="Routing/PgAdmin3.html">
            
                
                    <a href="../Routing/PgAdmin3.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                         Testing in PgAdmin3
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.3" data-path="Routing/QGIS.html">
            
                
                    <a href="../Routing/QGIS.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                         Testing in QGIS
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.4" data-path="Routing/WPS.html">
            
                
                    <a href="../Routing/WPS.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                         Adding to our WPS
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="4.5" data-path="Routing/Map.html">
            
                
                    <a href="../Routing/Map.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                         Using this on a web-based map
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="Appendix/Acknowledgements.html">
            
                
                    <a href="../Appendix/Acknowledgements.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         Wrapping Up
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="Appendix/Proxy.html">
            
                
                    <a href="../Appendix/Proxy.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         University of Nottingham Proxy
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >WPS PgRouting Workshop OSGIS 2014</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_13">
                    
                        <h1 id="using-the-routing-service-in-a-web-based-map">Using the Routing Service in a web-based map</h1>
<p>The WPS plugin doesn&#39;t seem to like the input and output format of the do service, so we&#39;ll go straight to seeing how this might work in a web-based map.</p>
<p>The ZOO Demo provides a really fully-featured example of this. Click on &quot;Applications/Web Browser&quot; to open firefox if it&#39;s not already open, and browse to:</p>
<pre><code>http://localhost/zoo-ws2013
</code></pre><p><img src="../images/routing_demo.png" alt="Routing Demo"></p>
<p>Firstly we&#39;re going to enable firebug in firefox so that we can see what requests are being made back to our routing service. If the firebug icon in the top right of the firefox window is not active (ie it&#39;s grey) then click it to activate it. This should bring up a window at the bottom of the browser:</p>
<p><img src="../images/firebug_netpanel.png" alt="Firebug Net Panel"></p>
<p>If &quot;Net&quot; is disabled, as it is in the screenshot above, click &quot;enable&quot; to make it active and ensure that the &quot;All&quot; tab is selected:</p>
<p><img src="../images/netpanel_active.png" alt="Net Panel Active"></p>
<p>Then, reload the main page and watch the requests scroll by!</p>
<p>To start plotting a route, select the blue flag in the tool bar and click on the map where you&#39;d like to start. Note that the routing data is not as extensive as the background map, so choose somewhere in the centre of Nottingham.</p>
<p>Select the red flag and click on the map to place it where you&#39;d like to end your route. The further apart the two points are, the longer the route will take to compute.</p>
<p>This web application not only computes the shortest path route, but gives turn-by-turn directions, and computes the elevation.</p>
<p>In firebug, find the request that starts with &quot;GET zoo_loader&quot; and hover over it with your mouse to see the full request. Right-click the request and choose &quot;Open in new tab&quot;. </p>
<p><img src="../images/firebug_zoorequest.png" alt="ZOO Firebug"></p>
<p>This is the &quot;Execute&quot; request to the WPS server, and when broken down it looks a lot like the ones we built earlier (with a few extra parameters):</p>
<p><img src="../images/execute_do.png" alt="Execute do process"></p>
<p>Looking at the results of this in our browser tab we can see the ProcessOutputs:</p>
<p><img src="../images/do_response.png" alt="do response"></p>
<p>Since we told WPS to use Mapserver, the response is a request to a temporary mapserver map file that we can potentially view in a browser. To do this, copy the reference href. It will look something like this:</p>
<p><img src="../images/mapserv_href.png" alt="Mapserv response"></p>
<p>Paste your response into a new browser tab. Unedited, it will not display as it is not in an image format, so change the format string in the URL from <strong>application/json</strong> to <strong>image/png</strong> to view the result:</p>
<p><img src="../images/mapserver_result.png" alt="mapserver result"></p>
<h2 id="javascript">JavaScript</h2>
<p>In order to send inputs to our routing process, we need to use JavaScript. </p>
<p>The basic process for this is as follows:</p>
<ol>
<li>Build the map (for example using OpenLayers) showing the base mapping that you want, and any overlays;</li>
<li>Add controls for establishing the start and end points of the route, for zooming in and out, resetting the page and so on;</li>
<li>Add a vector layer for holding the points that represent the start and end of the route;</li>
<li>Construct a URL that sends the Execute request off to the WPS service with the appropriate parameters;</li>
<li>Add a further layer to hold the json response from the WPS service.</li>
</ol>
<p>While the demo page that we have been using is rather more complicated than that, if we view the source of it we can see these steps in action.</p>
<p>Right-click the web page and choose &quot;View Page Source&quot;:</p>
<p><img src="../images/view_source.png" alt="View Page Source"></p>
<p>Amongst the scripts referenced at the top of the page are &quot;spatialtools_files\demo.js&quot; and &quot;WPS.js&quot;.</p>
<ul>
<li><strong>demo.js</strong> is the file that actually builds the openlayers map, creates the controls, gathers the inputs for the various routing services available, and displays the output;</li>
<li><strong>wps.js</strong> contains a number of helper functions for working with the WPS server.</li>
</ul>
<p>If we click on the link to &quot;spatialtools_files\demo.js&quot; (line 18) then we can explore the process of gathering the inputs for the do service.</p>
<p>The first half of this file, down to approximately line 596, is dedicated to building the map and the controls, and adding handlers for selecting and dragging the flags to indicate the start and end points of the route.</p>
<p>Line 190 onwards shows the creation of a points layer to hold the values of our start and end point, and it ensures that the first point added to the map is given the attribute &quot;start&quot; and the second &quot;end&quot;. These are sent to a function called pgRouting at around line 314.</p>
<p>Some additional code here also handles the case where the markers are dragged to a different location- but again at line 367 the points layer is sent to the pgRouting function.</p>
<p>This function is actually defined at line 722, where it checks that there are at least 2 points provided, and then sends them off to another function called runRouting. </p>
<p>The runRouting function is defined at line 597, and the first thing it does is transform the points from EPSG 900913 to EPS 4326. At line 628 it contructs the URL for the Execute request. Line 650 onwards are concerned with creating a layer to display the results.</p>
<p>Finally, two further WPS processes are also called in this block: UnionOneGeom and computeRouteProfile. These are needed for the elevation profile which is also computed, and the turn-by-turn directions.</p>
<h3 id="the-end">The End!</h3>
<p>If you are interested in building your own web application for WPS using openlayers then there are a number of useful tutorials. For one that is specific to ZOO, I would recommend the <a href="http://www.zoo-project.org/docs/workshop/2010/index.html" target="_blank">Practical Introduction to ZOO</a> given at FOSS4G 2010 (Osaka).</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../Routing/WPS.html" class="navigation navigation-prev " aria-label="Previous page: Adding to our WPS"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../Appendix/Acknowledgements.html" class="navigation navigation-next " aria-label="Next page: Wrapping Up"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
